name: Cycle Manager (4 Unique Slots)

on:
  pull_request:
    types: [closed]
  workflow_dispatch:      # Manual Trigger Button
  schedule:
    - cron: '0 */12 * * *' # Backup Check every 12 hours

permissions:
  issues: write

jobs:
  maintain-slots:
    runs-on: ubuntu-latest
    steps:
      - name: Maintain 4 Unique Issues
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { owner, repo } = context.repo;

            // --- 4 TYPES OF ISSUES CONFIGURATION ---
            const templates = [
              {
                title: "Contribution Slot: Add Your Name [A]",
                file: "`contributors/README.md`",
                label: "good first issue",
                note: "Add your name to the list alphabetically."
              },
              {
                title: "Contribution Slot: Add Your Name [B]",
                file: "`contributors/README.md`",
                label: "good first issue",
                note: "Add your name to the list alphabetically."
              },
              {
                title: "Documentation: Fix Grammar in Readme",
                file: "`README.md` (Main File)",
                label: "documentation",
                note: "**Note:** This change requires Manual Admin Review."
              },
              {
                title: "Community: Write a Review for DevSynthetix",
                file: "`reviews/feedback.md`",
                label: "community-feedback",
                note: "Write a short review about the project in the feedback file."
              }
            ];

            // 1. Check Currently Open Issues
            const openIssues = await github.rest.issues.listForRepo({
              owner, repo, state: 'open', per_page: 100
            });

            // 2. Loop through templates and create missing ones
            for (const tpl of templates) {
              const exists = openIssues.data.some(issue => issue.title === tpl.title);

              if (!exists) {
                console.log(`Creating missing issue: ${tpl.title}`);
                
                await github.rest.issues.create({
                  owner,
                  repo,
                  title: tpl.title,
                  body: `
                  ### ðŸ‘‹ Welcome Contributor!
                  
                  **Your Task:**
                  1. Fork this repository.
                  2. Edit the file: ${tpl.file}.
                  3. ${tpl.note}
                  4. Create a Pull Request (PR).
                  
                  ---
                  **Important:**
                  In your PR description, write:
                  > **Closes #<issue-number>**
                  
                  ---
                  **Ready? Comment "Assign me" below!** ðŸš€
                  `,
                  labels: [tpl.label, 'help wanted']
                });
                
                // Thoda wait taaki GitHub API block na kare
                await new Promise(r => setTimeout(r, 2000));
              }
            }
            
